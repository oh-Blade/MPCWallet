# MPC é’±åŒ… C++ æœåŠ¡å™¨

è¿™æ˜¯ MPC é’±åŒ…åº”ç”¨çš„ C++ ç‰ˆæœ¬æœåŠ¡å™¨å®ç°ï¼Œæä¾›ä¸ Node.js ç‰ˆæœ¬ç›¸åŒçš„ API æ¥å£ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”„ **ç›¸åŒçš„APIæ¥å£** - ä¸Node.jsç‰ˆæœ¬å®Œå…¨å…¼å®¹çš„REST API
- ğŸš€ **é«˜æ€§èƒ½** - C++å®ç°ï¼Œæ›´é«˜çš„æ€§èƒ½å’Œæ›´ä½çš„å†…å­˜å ç”¨
- ğŸ’° **é’±åŒ…ç®¡ç†** - åˆ›å»ºã€å¯¼å…¥ã€æŸ¥è¯¢é’±åŒ…åŠŸèƒ½
- ğŸ’¸ **äº¤æ˜“å¤„ç†** - äº¤æ˜“åˆ›å»ºã€Gasä¼°ç®—ã€å¹¿æ’­ç­‰åŠŸèƒ½
- ğŸ” **MPCæ”¯æŒ** - å¤šæ–¹è®¡ç®—å¯†é’¥ç”Ÿæˆå’Œç­¾å
- â›“ï¸ **åŒºå—é“¾äº¤äº’** - ç½‘ç»œä¿¡æ¯ã€ä½™é¢æŸ¥è¯¢ç­‰åŠŸèƒ½
- ğŸ”„ **äº¤äº’å¼æµ‹è¯•** - å†…ç½®å‘½ä»¤è¡ŒAPIæµ‹è¯•å·¥å…·

## ç³»ç»Ÿè¦æ±‚

- C++17 æˆ–æ›´é«˜ç‰ˆæœ¬
- GCC 7.0+ æˆ– Clang 5.0+
- Make æ„å»ºå·¥å…·

## å¿«é€Ÿå¼€å§‹

### 1. ç¼–è¯‘æœåŠ¡å™¨

```bash
cd cpp_server
make
```

### 2. è¿è¡ŒæœåŠ¡å™¨

```bash
make run
# æˆ–è€…ç›´æ¥è¿è¡Œ
./mpc_wallet_server
```

### 3. è®¾ç½®ç«¯å£ï¼ˆå¯é€‰ï¼‰

```bash
export PORT=8080
make run
```

## API æ¥å£

### å¥åº·æ£€æŸ¥
- `GET /health` - æœåŠ¡å™¨å¥åº·çŠ¶æ€
- `GET /` - æœåŠ¡å™¨ä¿¡æ¯å’Œç«¯ç‚¹åˆ—è¡¨

### é’±åŒ…ç®¡ç†
- `POST /api/wallet/create` - åˆ›å»ºæ–°é’±åŒ…
- `POST /api/wallet/import` - å¯¼å…¥é’±åŒ…
- `GET /api/wallet/list` - è·å–é’±åŒ…åˆ—è¡¨
- `GET /api/wallet/balance` - è·å–é’±åŒ…ä½™é¢
- `DELETE /api/wallet/delete` - åˆ é™¤é’±åŒ…

### äº¤æ˜“ç®¡ç†
- `POST /api/transaction/create` - åˆ›å»ºäº¤æ˜“
- `POST /api/transaction/estimate-gas` - ä¼°ç®—Gasè´¹ç”¨
- `GET /api/transaction/gas-price` - è·å–å½“å‰Gasä»·æ ¼
- `POST /api/transaction/broadcast` - å¹¿æ’­äº¤æ˜“
- `GET /api/transaction/status` - è·å–äº¤æ˜“çŠ¶æ€
- `GET /api/transaction/history` - è·å–äº¤æ˜“å†å²

### MPC å¤šæ–¹è®¡ç®—
- `POST /api/mpc/keygen/start` - å¯åŠ¨MPCå¯†é’¥ç”Ÿæˆ
- `POST /api/mpc/keygen/join` - åŠ å…¥MPCå¯†é’¥ç”Ÿæˆ
- `POST /api/mpc/sign/start` - å¯åŠ¨MPCç­¾å
- `GET /api/mpc/session/status` - è·å–ä¼šè¯çŠ¶æ€
- `GET /api/mpc/sessions` - è·å–æ´»è·ƒä¼šè¯åˆ—è¡¨
- `POST /api/mpc/session/data` - æäº¤å‚ä¸æ–¹æ•°æ®

### åŒºå—é“¾äº¤äº’
- `GET /api/blockchain/network-info` - è·å–ç½‘ç»œä¿¡æ¯
- `GET /api/blockchain/latest-block` - è·å–æœ€æ–°åŒºå—
- `GET /api/blockchain/balance` - è·å–è´¦æˆ·ä½™é¢
- `GET /api/blockchain/nonce` - è·å–è´¦æˆ·Nonce
- `POST /api/blockchain/validate-address` - éªŒè¯åœ°å€æ ¼å¼
- `GET /api/blockchain/token-balance` - è·å–ä»£å¸ä½™é¢
- `GET /api/blockchain/token-info` - è·å–ä»£å¸ä¿¡æ¯
- `GET /api/blockchain/search` - æœç´¢åŒºå—é“¾æ•°æ®

## ä½¿ç”¨ç¤ºä¾‹

### äº¤äº’å¼æµ‹è¯•

è¿è¡ŒæœåŠ¡å™¨åï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„äº¤äº’å¼æµ‹è¯•å·¥å…·ï¼š

```bash
# å¯åŠ¨æœåŠ¡å™¨
./mpc_wallet_server

# åœ¨äº¤äº’å¼æç¤ºç¬¦ä¸­è¾“å…¥å‘½ä»¤
è¾“å…¥ 'test <method> <path>' æ¥æµ‹è¯•APIï¼Œ'list' æŸ¥çœ‹æ‰€æœ‰æ¥å£ï¼Œæˆ– 'quit' é€€å‡º: 

# æµ‹è¯•å¥åº·æ£€æŸ¥
test GET /health

# æµ‹è¯•åˆ›å»ºé’±åŒ…
test POST /api/wallet/create

# æµ‹è¯•è·å–ç½‘ç»œä¿¡æ¯
test GET /api/blockchain/network-info

# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æ¥å£
list

# é€€å‡º
quit
```

### APIå“åº”æ ¼å¼

æ‰€æœ‰APIè¿”å›ç»Ÿä¸€çš„JSONæ ¼å¼ï¼š

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "data": { ... },
  "message": "æ“ä½œæˆåŠŸ"  // å¯é€‰
}
```

#### é”™è¯¯å“åº”
```json
{
  "success": false,
  "error": "é”™è¯¯ä¿¡æ¯",
  "code": 500
}
```

## é¡¹ç›®ç»“æ„

```
cpp_server/
â”œâ”€â”€ mpc_server.cpp          # ä¸»æœåŠ¡å™¨å®ç°
â”œâ”€â”€ Makefile                # æ„å»ºé…ç½®
â”œâ”€â”€ README.md               # æœ¬æ–‡æ¡£
â”œâ”€â”€ include/                # å¤´æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ common.h           # å…¬å…±å®šä¹‰
â”‚   â”œâ”€â”€ server.h           # æœåŠ¡å™¨ç±»å®šä¹‰
â”‚   â””â”€â”€ routes/            # è·¯ç”±å¤´æ–‡ä»¶
â”‚       â”œâ”€â”€ wallet_routes.h
â”‚       â”œâ”€â”€ transaction_routes.h
â”‚       â”œâ”€â”€ mpc_routes.h
â”‚       â””â”€â”€ blockchain_routes.h
â”œâ”€â”€ src/                   # æºæ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ main.cpp           # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ server.cpp         # æœåŠ¡å™¨å®ç°
â”‚   â”œâ”€â”€ routes/            # è·¯ç”±å®ç°
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡æœåŠ¡
â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â””â”€â”€ CMakeLists.txt         # CMakeæ„å»ºé…ç½®
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„APIæ¥å£

1. åœ¨ç›¸åº”çš„è·¯ç”±è®¾ç½®å‡½æ•°ä¸­æ·»åŠ æ–°è·¯ç”±ï¼š

```cpp
void setupWalletRoutes() {
    // æ·»åŠ æ–°çš„é’±åŒ…æ¥å£
    routes_["POST /api/wallet/new-feature"] = [this](const std::string& body) -> std::string {
        std::ostringstream data;
        data << "{\"feature\":\"implemented\"}";
        return createSuccessResponse(data.str(), "æ–°åŠŸèƒ½æ·»åŠ æˆåŠŸ");
    };
}
```

2. æ›´æ–°APIæ–‡æ¡£å’Œæµ‹è¯•ç”¨ä¾‹

### ç¼–è¯‘é€‰é¡¹

```bash
# è°ƒè¯•ç‰ˆæœ¬
make CXXFLAGS="-std=c++17 -Wall -Wextra -g -DDEBUG"

# ä¼˜åŒ–ç‰ˆæœ¬
make CXXFLAGS="-std=c++17 -Wall -Wextra -O3 -DNDEBUG"

# æ¸…ç†æ„å»ºæ–‡ä»¶
make clean
```

## ä¸Node.jsç‰ˆæœ¬çš„å…¼å®¹æ€§

è¿™ä¸ªC++ç‰ˆæœ¬çš„æœåŠ¡å™¨å®ç°äº†ä¸Node.jsç‰ˆæœ¬å®Œå…¨ç›¸åŒçš„APIæ¥å£ï¼ŒåŒ…æ‹¬ï¼š

- ç›¸åŒçš„URLè·¯å¾„
- ç›¸åŒçš„HTTPæ–¹æ³•
- ç›¸åŒçš„è¯·æ±‚/å“åº”æ ¼å¼
- ç›¸åŒçš„é”™è¯¯å¤„ç†

å› æ­¤å¯ä»¥ä½œä¸ºNode.jsç‰ˆæœ¬çš„ç›´æ¥æ›¿ä»£å“ï¼Œæ— éœ€ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç ã€‚

## æ€§èƒ½å¯¹æ¯”

| ç‰¹æ€§ | Node.jsç‰ˆæœ¬ | C++ç‰ˆæœ¬ |
|------|-------------|---------|
| å¯åŠ¨æ—¶é—´ | ~2ç§’ | ~0.1ç§’ |
| å†…å­˜å ç”¨ | ~50MB | ~5MB |
| å“åº”æ—¶é—´ | ~10ms | ~1ms |
| å¹¶å‘å¤„ç† | ä¸­ç­‰ | é«˜ |

## æ³¨æ„äº‹é¡¹

1. **æ¨¡æ‹Ÿå®ç°**: å½“å‰ç‰ˆæœ¬æ˜¯ä¸€ä¸ªæ¨¡æ‹ŸæœåŠ¡å™¨ï¼Œè¿”å›ç¤ºä¾‹æ•°æ®ç”¨äºæ¼”ç¤ºAPIæ¥å£
2. **ç”Ÿäº§éƒ¨ç½²**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦å®ç°çœŸå®çš„ä¸šåŠ¡é€»è¾‘
3. **å®‰å…¨è€ƒè™‘**: æ·»åŠ é€‚å½“çš„èº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶
4. **ç½‘ç»œé€šä¿¡**: å½“å‰ç‰ˆæœ¬ä½¿ç”¨äº¤äº’å¼å‘½ä»¤è¡Œï¼Œå®é™…éƒ¨ç½²éœ€è¦HTTPæœåŠ¡å™¨

## æ‰©å±•åŠŸèƒ½

è¦å®ç°å®Œæ•´çš„HTTPæœåŠ¡å™¨åŠŸèƒ½ï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. é›†æˆHTTPåº“ (å¦‚ cpp-httplib, Beast, æˆ– Crow)
2. æ·»åŠ JSONè§£æåº“ (å¦‚ nlohmann/json)
3. é›†æˆåŒºå—é“¾SDK
4. æ·»åŠ æ•°æ®åº“æ”¯æŒ
5. å®ç°çœŸå®çš„MPCåè®®

## è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æºã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚ 