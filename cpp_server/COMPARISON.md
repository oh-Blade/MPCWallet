# ğŸ”„ MPC å®ç°å¯¹æ¯”ï¼šæ¨¡æ‹Ÿ vs çœŸå®

## ğŸ“Š **å½“å‰çŠ¶æ€æ€»è§ˆ**

| æ–¹é¢ | æ¨¡æ‹Ÿå®ç° (`mpc_server.cpp`) | çœŸå®å®ç° (`mpc_server_real.cpp` + cb-mpc) |
|------|----------------------------|------------------------------------------|
| **å®‰å…¨æ€§** | âŒ æ— å¯†ç å­¦å®‰å…¨æ€§ | âœ… å·¥ä¸šçº§å¯†ç å­¦å®‰å…¨ |
| **å¼€å‘éš¾åº¦** | âœ… ç®€å•ï¼Œå·²å®Œæˆ | âš ï¸ å¤æ‚ï¼Œéœ€è¦é¢å¤–å¼€å‘ |
| **å¤–éƒ¨ä¾èµ–** | âœ… æ— ä¾èµ– | âŒ éœ€è¦ cb-mpc åº“ |
| **æ€§èƒ½** | âš¡ æå¿« (~1ms) | ğŸŒ è¾ƒæ…¢ (~100-500ms) |
| **å†…å­˜ä½¿ç”¨** | ğŸ’š æä½ (~5MB) | ğŸŸ¡ è¾ƒé«˜ (~20-50MB) |
| **ç¼–è¯‘å¤æ‚åº¦** | âœ… ç®€å• | âŒ å¤æ‚ |

## ğŸ­ **æ¨¡æ‹Ÿå®ç°è¯¦æƒ…**

### âœ… **ä¼˜ç‚¹**

1. **å¼€å‘å¿«é€Ÿ** - ç«‹å³å¯ç”¨ï¼Œæ— éœ€é¢å¤–ä¾èµ–
2. **æ¼”ç¤ºå‹å¥½** - å®Œç¾ç”¨äºAPIæ¼”ç¤ºå’Œå‰ç«¯å¼€å‘
3. **è°ƒè¯•ç®€å•** - å®¹æ˜“ç†è§£å’Œè°ƒè¯•
4. **èµ„æºå ç”¨å°‘** - å†…å­˜å’ŒCPUä½¿ç”¨æå°‘

### âŒ **ç¼ºç‚¹**

1. **æ— çœŸå®å®‰å…¨æ€§** - ç”Ÿæˆçš„"å¯†é’¥"å’Œ"ç­¾å"æ˜¯å‡çš„
2. **ä¸èƒ½ç”¨äºç”Ÿäº§** - ä»»ä½•äººéƒ½å¯ä»¥ä¼ªé€ äº¤æ˜“
3. **æ— çœŸå®MPCåè®®** - æ²¡æœ‰åˆ†å¸ƒå¼è®¡ç®—

### ğŸ“ **ä»£ç ç¤ºä¾‹**

```cpp
// å½“å‰çš„æ¨¡æ‹Ÿå¯†é’¥ç”Ÿæˆ - è¿”å›å‡æ•°æ®
routes_["POST /api/mpc/keygen/start"] = [this](const std::string& body) -> std::string {
    std::ostringstream data;
    data << "{\"sessionId\":\"mpc_session_" << std::time(nullptr) 
         << "\",\"status\":\"started\"}";  // è¿™äº›éƒ½æ˜¯å‡æ•°æ®ï¼
    return createSuccessResponse(data.str());
};
```

## ğŸ” **çœŸå®å®ç°è¯¦æƒ…**

### âœ… **ä¼˜ç‚¹**

1. **å¯†ç å­¦å®‰å…¨** - åŸºäºç»è¿‡éªŒè¯çš„MPCåè®®
2. **ç”Ÿäº§å¯ç”¨** - çœŸå®çš„å¯†é’¥åˆ†ç‰‡å’Œç­¾å
3. **è¡Œä¸šæ ‡å‡†** - ä½¿ç”¨Coinbaseå¼€æºçš„cb-mpcåº“
4. **æŠ—æ”»å‡»** - é˜²æ­¢å•ç‚¹æ•…éšœå’Œæ¶æ„å‚ä¸æ–¹

### âŒ **ç¼ºç‚¹**

1. **å¼€å‘å¤æ‚** - éœ€è¦ç†è§£MPCåè®®
2. **æ€§èƒ½è¾ƒæ…¢** - å¯†ç å­¦è®¡ç®—è€—æ—¶
3. **ä¾èµ–å¤æ‚** - éœ€è¦ç¼–è¯‘å’Œé›†æˆcb-mpc
4. **è°ƒè¯•å›°éš¾** - åˆ†å¸ƒå¼åè®®è°ƒè¯•å¤æ‚

### ğŸ“ **ä»£ç ç¤ºä¾‹**

```cpp
// çœŸå®çš„MPCå¯†é’¥ç”Ÿæˆ
#include "cbmpc/protocol/ec_dkg.h"

routes_["POST /api/mpc/keygen/start"] = [this](const std::string& body) -> std::string {
    try {
        // åˆ›å»ºçœŸå®çš„DKGåè®®å®ä¾‹
        auto keygen = std::make_shared<coinbase::mpc::eckey::keygen_t>();
        keygen->init(2, 2); // 2-of-2 é˜ˆå€¼æ–¹æ¡ˆ
        
        // æ‰§è¡ŒçœŸå®çš„ç¬¬ä¸€è½®åè®®
        auto round1_data = keygen->round1(); // çœŸå®çš„å¯†ç å­¦è®¡ç®—ï¼
        
        // å­˜å‚¨ä¼šè¯çŠ¶æ€
        sessions_[sessionId] = keygen;
        
        // è¿”å›çœŸå®çš„åè®®æ•°æ®
        return createSuccessResponse(serialize(round1_data));
        
    } catch (const std::exception& e) {
        return createErrorResponse("çœŸå®MPCæ“ä½œå¤±è´¥: " + std::string(e.what()));
    }
};
```

## âš–ï¸ **ä½¿ç”¨åœºæ™¯å»ºè®®**

### ğŸ¯ **ä½¿ç”¨æ¨¡æ‹Ÿå®ç°çš„åœºæ™¯**

- **API å¼€å‘å’Œæµ‹è¯•**
- **å‰ç«¯é›†æˆå¼€å‘**
- **æ¼”ç¤ºå’ŒåŸå‹éªŒè¯**
- **å­¦ä¹ å’Œç†è§£MPCæ¦‚å¿µ**
- **CI/CD ç®¡é“ä¸­çš„å¿«é€Ÿæµ‹è¯•**

### ğŸ”’ **éœ€è¦çœŸå®å®ç°çš„åœºæ™¯**

- **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**
- **å®é™…èµ„é‡‘ç®¡ç†**
- **å®‰å…¨å®¡è®¡è¦æ±‚**
- **å¤šæ–¹çœŸå®åä½œ**
- **åˆè§„æ€§è¦æ±‚**

## ğŸš€ **è¿ç§»è·¯å¾„**

### é˜¶æ®µ1ï¼šè¯„ä¼°éœ€æ±‚
```bash
# è¯„ä¼°é—®é¢˜ï¼š
1. æ˜¯å¦éœ€è¦çœŸå®çš„å¯†ç å­¦å®‰å…¨æ€§ï¼Ÿ
2. æ˜¯å¦æœ‰å¤šæ–¹çœŸå®åä½œéœ€æ±‚ï¼Ÿ
3. å›¢é˜Ÿæ˜¯å¦æœ‰MPCåè®®å¼€å‘ç»éªŒï¼Ÿ
4. æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¼€å‘æ—¶é—´ï¼Ÿ
```

### é˜¶æ®µ2ï¼šå®‰è£…ä¾èµ–ï¼ˆå¦‚æœéœ€è¦çœŸå®å®ç°ï¼‰
```bash
# è¿è¡Œå®‰è£…è„šæœ¬
./install_cbmpc.sh
```

### é˜¶æ®µ3ï¼šæ¸è¿›å¼è¿ç§»
```bash
# 1. ä¿æŒæ¨¡æ‹Ÿç‰ˆæœ¬ç”¨äºå¼€å‘å’Œæµ‹è¯•
cp mpc_server.cpp mpc_server_mock.cpp

# 2. å¼€å‘çœŸå®ç‰ˆæœ¬ç”¨äºç”Ÿäº§
# ä½¿ç”¨ mpc_server_real.cpp ä½œä¸ºèµ·ç‚¹

# 3. é€šè¿‡é…ç½®åˆ‡æ¢
export MPC_MODE=real  # æˆ– mock
```

## ğŸ” **æŠ€æœ¯å¯¹æ¯”è¯¦æƒ…**

### å¯†é’¥ç”Ÿæˆå¯¹æ¯”

| æ“ä½œæ­¥éª¤ | æ¨¡æ‹Ÿå®ç° | çœŸå®å®ç° |
|----------|----------|----------|
| åˆå§‹åŒ– | `sessionId = "fake_" + timestamp` | `keygen = new ec_dkg(); keygen->init(n, t)` |
| ç¬¬ä¸€è½® | `return {"round": 1}` | `round1_data = keygen->round1()` |
| æ•°æ®äº¤æ¢ | `return "ok"` | `keygen->process_round2(partner_data)` |
| å®Œæˆ | `return "fake_key"` | `key_share = keygen->get_key_share()` |

### ç­¾åå¯¹æ¯”

| æ“ä½œæ­¥éª¤ | æ¨¡æ‹Ÿå®ç° | çœŸå®å®ç° |
|----------|----------|----------|
| åˆå§‹åŒ– | `return "fake_signature"` | `signer = new ecdsa_2pc(key_share, message)` |
| ç¬¬ä¸€è½® | `return {"r": "fake_r"}` | `round1_data = signer->round1()` |
| ç¬¬äºŒè½® | `return {"s": "fake_s"}` | `round2_data = signer->round2(partner_data)` |
| å®Œæˆ | `return "0xfake..."` | `signature = signer->get_signature()` |

## ğŸ¯ **æ¨èæ–¹æ¡ˆ**

### å¯¹äºå­¦ä¹ å’Œå¼€å‘ï¼š
```bash
# ä½¿ç”¨æ¨¡æ‹Ÿå®ç°ï¼Œå¿«é€Ÿå¼€å§‹
./mpc_server  # å½“å‰ç‰ˆæœ¬
```

### å¯¹äºç”Ÿäº§ç¯å¢ƒï¼š
```bash
# å®‰è£…cb-mpcå¹¶ä½¿ç”¨çœŸå®å®ç°
./install_cbmpc.sh
./build_real/mpc_server_real
```

### æ··åˆæ–¹æ¡ˆï¼š
```cpp
// åœ¨ä»£ç ä¸­æ”¯æŒä¸¤ç§æ¨¡å¼
if (getenv("MPC_MODE") == "real") {
    // ä½¿ç”¨ cb-mpc çœŸå®å®ç°
} else {
    // ä½¿ç”¨æ¨¡æ‹Ÿå®ç°
}
```

---

**æ€»ç»“**: å½“å‰çš„æ¨¡æ‹Ÿå®ç°å®Œå…¨æ»¡è¶³APIæ¼”ç¤ºå’Œå¼€å‘éœ€æ±‚ï¼Œä½†å¦‚æœéœ€è¦çœŸå®çš„å¯†ç å­¦å®‰å…¨æ€§ï¼Œåˆ™å¿…é¡»é›†æˆcb-mpcåº“å®ç°çœŸå®çš„MPCåè®®ã€‚ 