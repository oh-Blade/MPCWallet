# 🐛 MPC钱包应用调试完整指南

## 📋 调试环境状态

✅ **已准备就绪的环境：**
- 🎯 模拟器已连接 (emulator-5554)
- 📱 Android Studio已启动
- 🔧 调试脚本已创建
- 📊 22个Kotlin文件已确认
- 🛠️ 25个依赖库已配置

## 🎯 推荐调试方法

### **方法1: Android Studio可视化调试 (推荐)**

1. **启动调试环境：**
   ```bash
   ./android_studio_debug.sh
   ```

2. **在Android Studio中设置断点：**
   - `MPCWalletApplication.kt:40` - 应用初始化
   - `MainActivity.kt:25` - 主Activity创建
   - `MPCKeyGenerator.kt:50` - 密钥生成入口
   - `MPCSigner.kt:35` - 交易签名过程
   - `QRCodeManager.kt:30` - QR码生成

3. **启动调试：**
   - 点击Debug按钮 (🐞)
   - 或使用快捷键 `Shift+F9`

### **方法2: 命令行快速调试**

1. **快速操作：**
   ```bash
   ./quick_debug.sh
   ```

2. **日志监控：**
   ```bash
   adb logcat | grep -E "(MPCWallet|MPC_|Error|Exception)"
   ```

## 🔍 MPC功能专项调试

### **密钥生成调试要点**
- **断点位置：** `MPCKeyGenerator.generateKeyShares()`
- **检查项目：**
  - threshold 和 n 参数值
  - keyShares 数组长度
  - SecureRandom 种子生成
  - Shamir 分片算法正确性

### **签名过程调试要点**
- **断点位置：** `MPCSigner.signTransaction()`
- **检查项目：**
  - 私钥分片完整性
  - 部分签名生成过程
  - 签名聚合算法
  - 最终签名验证

### **QR码通信调试要点**
- **断点位置：** `QRCodeManager.generateQRCode()`
- **检查项目：**
  - 数据序列化格式
  - QR码容量限制
  - 数据分片逻辑
  - Base64编码正确性

## 📱 应用功能测试流程

1. **启动应用** → MainActivity.onCreate()
2. **查看钱包列表** → WalletScreen.compose()
3. **创建新钱包** → KeyGenerationScreen
4. **设置阈值参数** → MPC密钥生成流程
5. **生成密钥分片** → MPCKeyGenerator
6. **生成QR码** → QRCodeManager
7. **扫描QR码** → QRScanScreen
8. **发送交易** → TransactionScreen

## 🚨 常见问题解决方案

### **问题1: 应用无法启动**
```bash
# 检查应用安装状态
adb shell pm list packages | grep mpcwallet

# 查看启动错误
adb logcat | grep -E "(FATAL|ERROR)"

# 重新安装应用 (在Android Studio中)
Build > Clean Project
Build > Rebuild Project
```

### **问题2: MPC算法异常**
```bash
# 检查BouncyCastle初始化
adb logcat | grep "BouncyCastle"

# 验证密钥分片存储
adb shell run-as com.mpcwallet.app ls files/
```

### **问题3: 网络连接问题**
```bash
# 检查Infura API配置
grep -r "infura" app/src/main/

# 测试网络权限
adb shell dumpsys package com.mpcwallet.app | grep permission
```

## 📊 调试窗口使用指南

### **Variables 窗口**
- 查看当前作用域内的所有变量
- 支持表达式求值
- 可以修改变量值进行测试

### **Watches 窗口**
- 添加自定义监控表达式
- 实时跟踪关键变量变化
- 推荐监控：
  - `keyShares.size`
  - `threshold`
  - `privateKeyShare != null`

### **Call Stack 窗口**
- 查看方法调用链
- 快速跳转到调用点
- 分析程序执行路径

### **Logcat 窗口**
- 过滤应用日志：`package:com.mpcwallet.app`
- 搜索关键词：`MPC_`, `Error`, `Exception`
- 设置日志级别：Debug, Info, Warn, Error

## ⚡ 快速调试命令

```bash
# 启动日志监控
adb logcat | grep MPCWallet

# 重启应用
adb shell am force-stop com.mpcwallet.app
adb shell am start -n com.mpcwallet.app/.ui.MainActivity

# 清除应用数据
adb shell pm clear com.mpcwallet.app

# 查看应用状态
adb shell ps | grep mpcwallet
```

## 🎯 调试最佳实践

1. **设置有意义的断点** - 不要在每行都设断点
2. **使用条件断点** - 只在特定条件下暂停
3. **善用日志输出** - 添加自定义日志标签
4. **分步调试** - 一次专注一个功能模块
5. **备份工作状态** - 调试前提交代码

## 📞 需要帮助时

如果遇到无法解决的问题：
1. 保存完整的错误日志
2. 记录重现步骤
3. 截图关键调试信息
4. 描述期望行为vs实际行为

---

🎉 **调试环境已完全准备就绪！现在可以开始高效调试您的MPC钱包应用了。** 